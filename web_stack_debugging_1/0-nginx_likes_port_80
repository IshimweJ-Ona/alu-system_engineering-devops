#!/usr/bin/env bash
# Fix Nginx to listen on all IPv4 addresses on port 80 and start the service

# Update packages
apt-get update -y

# Install nginx if not already installed
apt-get install -y nginx

# Ensure the default site listens on all IPv4 addresses
sed -i 's/listen 127.0.0.1:80 default_server;/listen 80 default_server;/' /etc/nginx/sites-available/default
sed -i 's/listen \[::\]:80 default_server;/listen [::]:80 default_server;/' /etc/nginx/sites-available/default

# Enable default site
ln -sf /etc/nginx/sites-available/default /etc/nginx/sites-enabled/default

# Kill any process using port 80
fuser -k 80/tcp 2>/dev/null || true

# Restart Nginx (service first, fallback to direct start)
if ! /etc/init.d/nginx restart; then
    nginx
fi


